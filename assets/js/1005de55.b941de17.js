"use strict";(globalThis.webpackChunkkonifer_docs=globalThis.webpackChunkkonifer_docs||[]).push([[602],{2571:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Concepts/concepts-path-configuration","title":"Path Configuration","description":"Path Configuration is one of the most powerful features within Konifer. It gives you fine-grained control over how your","source":"@site/docs/Concepts/path-configuration.md","sourceDirName":"Concepts","slug":"/Concepts/concepts-path-configuration","permalink":"/Concepts/concepts-path-configuration","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"id":"concepts-path-configuration","title":"Path Configuration","sidebar_label":"Path Configuration"},"sidebar":"docsSidebar","previous":{"title":"Architecture","permalink":"/Concepts/concepts-architecture"},"next":{"title":"LQIPs","permalink":"/Concepts/concepts-lqip"}}');var s=t(4848),r=t(8453);const o={sidebar_position:2,id:"concepts-path-configuration",title:"Path Configuration",sidebar_label:"Path Configuration"},a="Overview",l={},c=[{value:"Example Configuration",id:"example-configuration",level:2},{value:"Single Segment (<code>*</code>)",id:"single-segment-",level:2},{value:"Multi-Segment",id:"multi-segment",level:2},{value:"Example",id:"example",level:3},{value:"Shallow Inheritance",id:"shallow-inheritance",level:2},{value:"Example 1: List Overwrite",id:"example-1-list-overwrite",level:3},{value:"Example 2: Empty List Overwrite",id:"example-2-empty-list-overwrite",level:3},{value:"The <code>/**</code> Root Path",id:"the--root-path",level:2},{value:"System Defaults",id:"system-defaults",level:2},{value:"Example",id:"example-1",level:2}];function h(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"overview",children:"Overview"})}),"\n",(0,s.jsx)(n.p,{children:"Path Configuration is one of the most powerful features within Konifer. It gives you fine-grained control over how your\nassets are processed, stored, and delivered, all based on the API path you use to store them."}),"\n",(0,s.jsxs)(n.p,{children:["Path configuration allows you to treat different categories of assets (like public avatars, private documents, or marketing\nmaterials) in completely different ways, all from a single, unified configuration file, ",(0,s.jsx)(n.code,{children:"konifer.conf"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Path Configuration is defined in the ",(0,s.jsx)(n.code,{children:"paths"})," array in ",(0,s.jsx)(n.code,{children:"konifer.conf"}),". Each object in the array must have\na ",(0,s.jsx)(n.code,{children:"path"})," attribute that specifies the path pattern it applies to."]}),"\n",(0,s.jsx)(n.h2,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["You can configure the path ",(0,s.jsx)(n.code,{children:"/public/avatars/**"})," to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Generate three specific thumbnail sizes eagerly upon upload."}),"\n",(0,s.jsx)(n.li,{children:"Limit the height and width of a supplied image."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'paths = [\n  {\n    path = "/public/avatars/**"\n    eager-variants = [ small, medium, large ]\n    max-height = 300\n    max-width = 500\n  }\n]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["While at the same time, configuring the path ",(0,s.jsx)(n.code,{children:"/users/*/profile-picture"})," to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use a completely different S3 bucket."}),"\n",(0,s.jsx)(n.li,{children:"Only accept JPEG images"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'paths = [\n  {\n    path = "/users/*/profile-picture"\n    bucket = "profile-pictures"\n    allowed-content-types = [ \n      "image/jpeg"\n    ]\n  }\n]\n'})}),"\n",(0,s.jsx)(n.h1,{id:"wildcard-matching",children:"Wildcard Matching"}),"\n",(0,s.jsxs)(n.p,{children:["You don't have to define rules for every exact path. Konifer allows you to apply rules to entire categories of assets\nusing wildcards in your ",(0,s.jsx)(n.code,{children:"konifer.conf"})," file."]}),"\n",(0,s.jsx)(n.p,{children:"There are two types of wildcards:"}),"\n",(0,s.jsxs)(n.h2,{id:"single-segment-",children:["Single Segment (",(0,s.jsx)(n.code,{children:"*"}),")"]}),"\n",(0,s.jsx)(n.p,{children:"Matches any single path segment (the text between two slashes)."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),": ",(0,s.jsx)(n.code,{children:"users/*"})," matches ",(0,s.jsx)(n.code,{children:"users/123"})," but not ",(0,s.jsx)(n.code,{children:"users/123/profile"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"multi-segment",children:"Multi-Segment"}),"\n",(0,s.jsx)(n.p,{children:'Greedily matches zero or more path segments. This is the most common and powerful wildcard for applying rules\nto an entire "directory."'}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),": ",(0,s.jsx)(n.code,{children:"users/**"})," matches ",(0,s.jsx)(n.code,{children:"users/"}),", ",(0,s.jsx)(n.code,{children:"users/123"}),", and ",(0,s.jsx)(n.code,{children:"users/123/profile"}),"."]}),"\n",(0,s.jsx)(n.h1,{id:"inheritance",children:"Inheritance"}),"\n",(0,s.jsxs)(n.p,{children:["Paths inherit the configuration of parent paths. For any given configuration value, ",(0,s.jsx)(n.strong,{children:"the most-specific configuration property\nwins"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(n.p,{children:["Creating an asset at ",(0,s.jsx)(n.code,{children:"/users/123"})," will use the ",(0,s.jsx)(n.code,{children:"users"})," bucket (inherited from the ",(0,s.jsx)(n.code,{children:"/users"})," path) and will also have\nrestrictions on the allowed content types (defined on the more-specific ",(0,s.jsx)(n.code,{children:"/users/123"})," path)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'paths = [\n  {\n    path = "/users"\n    bucket = "users"\n  },\n  {\n    path = "/users/123"\n    allowed-content-types = [\n      "image/png",\n      "image/jpeg"\n    ]\n  }\n]\n'})}),"\n",(0,s.jsx)(n.h2,{id:"shallow-inheritance",children:"Shallow Inheritance"}),"\n",(0,s.jsxs)(n.p,{children:["Konifer's inheritance is ",(0,s.jsx)(n.strong,{children:"shallow"}),". Nested configuration values within objects or lists are not merged."]}),"\n",(0,s.jsxs)(n.p,{children:["If a child path defines a list or object property (like ",(0,s.jsx)(n.code,{children:"allowed-content-types"}),"), the child's property completely\noverwrites the parent's property."]}),"\n",(0,s.jsx)(n.h3,{id:"example-1-list-overwrite",children:"Example 1: List Overwrite"}),"\n",(0,s.jsxs)(n.p,{children:["Creating an asset at ",(0,s.jsx)(n.code,{children:"/users/123"})," will not allow ",(0,s.jsx)(n.code,{children:"image/png"})," since list properties are not merged. The ",(0,s.jsx)(n.code,{children:"image/png"}),"\nvalue from the parent is discarded, not merged."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'paths = [\n  {\n    path = "/users"\n    allowed-content-types = [\n      "image/png",\n    ]\n  },\n  {\n    path = "/users/123"\n    allowed-content-types = [\n      "image/jpeg"\n    ]\n  }\n]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-empty-list-overwrite",children:"Example 2: Empty List Overwrite"}),"\n",(0,s.jsxs)(n.p,{children:["Creating an asset at ",(0,s.jsx)(n.code,{children:"/users/123"})," will not allow ",(0,s.jsx)(n.em,{children:"any"})," content-type. The empty list from the child path overwrites\nthe parent's list."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'paths = [\n  {\n    path = "/users"\n    allowed-content-types = [\n      "image/png",\n    ]\n  },\n  {\n    path = "/users/123"\n    allowed-content-types = [ ]\n  }\n]\n'})}),"\n",(0,s.jsx)(n.h1,{id:"default-path-configuration",children:"Default Path Configuration"}),"\n",(0,s.jsx)(n.p,{children:"You have two types of defaults to be aware of:"}),"\n",(0,s.jsxs)(n.h2,{id:"the--root-path",children:["The ",(0,s.jsx)(n.code,{children:"/**"})," Root Path"]}),"\n",(0,s.jsxs)(n.p,{children:["To specify a default configuration that applies to all paths, set the ",(0,s.jsx)(n.code,{children:"path"})," attribute to ",(0,s.jsx)(n.code,{children:"/**"}),". This serves as the\nroot of the inheritance tree. All other paths will inherit from this base configuration."]}),"\n",(0,s.jsx)(n.h2,{id:"system-defaults",children:"System Defaults"}),"\n",(0,s.jsxs)(n.p,{children:["For any value not defined in the ",(0,s.jsx)(n.code,{children:"/**"})," path or any of its children, Konifer uses a hardcoded system default.\nConsult the Path Configuration Reference (TODO) to determine the system default for each property."]}),"\n",(0,s.jsx)(n.h2,{id:"example-1",children:"Example"}),"\n",(0,s.jsxs)(n.p,{children:["Storing at ",(0,s.jsx)(n.code,{children:"/users/123/profile-picture"})," will only allow ",(0,s.jsx)(n.code,{children:"image/png"})," but storing at ",(0,s.jsx)(n.code,{children:"/blog/123"})," would only allow ",(0,s.jsx)(n.code,{children:"image/png"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'paths = [\n  {\n    path = "/**"\n    allowed-content-types = [\n      "image/png",\n    ]\n  }\n  {\n    path = "/users/**"\n    allowed-content-types = [\n      "image/png",\n    ]\n  }\n]\n'})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);