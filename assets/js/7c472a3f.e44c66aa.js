"use strict";(globalThis.webpackChunkkonifer_docs=globalThis.webpackChunkkonifer_docs||[]).push([[998],{219:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Reference/reference-variant-storage","title":"Storing Assets and Variants","description":"Konifer leverages a dual-store architecture to manage assets efficiently.","source":"@site/docs/Reference/asset-storage.md","sourceDirName":"Reference","slug":"/Reference/reference-variant-storage","permalink":"/konifer-docs/Reference/reference-variant-storage","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"id":"reference-variant-storage","title":"Storing Assets and Variants","sidebar_label":"Storing Assets"},"sidebar":"docsSidebar","previous":{"title":"Image Processing","permalink":"/konifer-docs/Reference/image-processing-reference"},"next":{"title":"HTTP Caching","permalink":"/konifer-docs/Reference/http-caching"}}');var r=s(4848),i=s(8453);const o={sidebar_position:4,id:"reference-variant-storage",title:"Storing Assets and Variants",sidebar_label:"Storing Assets"},a="Storage Architecture",c={},l=[{value:"Object Store Configuration",id:"object-store-configuration",level:2},{value:"In-memory Configuration",id:"in-memory-configuration",level:3},{value:"AWS S3",id:"aws-s3",level:3},{value:"S3-compatible Providers",id:"s3-compatible-providers",level:4},{value:"Filesystem",id:"filesystem",level:3},{value:"Buckets and Keys",id:"buckets-and-keys",level:4},{value:"Redirection",id:"redirection",level:3},{value:"Metadata Store (PostgreSQL)",id:"metadata-store-postgresql",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"storage-architecture",children:"Storage Architecture"})}),"\n",(0,r.jsx)(n.p,{children:"Konifer leverages a dual-store architecture to manage assets efficiently."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Object Store:"})," Persists the physical variant content (the binaries). Konifer supports AWS S3, S3-compatible, filesystem and in-memory providers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metadata Store:"})," Persists relational data, path hierarchies, tags, and labels. Currently, in-memory and PostgreSQL are the supported engines."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"object-store-configuration",children:"Object Store Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Konifer supports three object store implementations:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"In-memory"}),"\n",(0,r.jsx)(n.li,{children:"S3 (including S3-compatible providers)"}),"\n",(0,r.jsx)(n.li,{children:"Filesystem"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"in-memory-configuration",children:"In-memory Configuration"}),"\n",(0,r.jsx)(n.p,{children:"To enable development mode, set the following flags in your configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hocon",children:"object-store {\n  in-memory = true\n}\ndatabase {\n  in-memory = true\n}\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Non-Production Use In-memory implementations are ",(0,r.jsx)(n.strong,{children:"ephemeral"}),". All data is lost when the container restarts.\nAdditionally, storage capacity is strictly limited by the JVM Heap size. Uploading large files in this mode may cause\n",(0,r.jsx)(n.code,{children:"OutOfMemoryError"})," crashes."]})}),"\n",(0,r.jsx)(n.h3,{id:"aws-s3",children:"AWS S3"}),"\n",(0,r.jsxs)(n.p,{children:["By default, Konifer looks for AWS credentials using the standard ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/sdkref/latest/guide/standardized-credentials.html#credentialProviderChain",children:"AWS Default Credential Provider Chain"}),".\nThis enables seamless authentication when running on EC2 instances with IAM roles or locally with ",(0,r.jsx)(n.code,{children:"~/.aws/credentials"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hocon",children:'object-store {\n  s3 {\n    # Required for URL generation\n    region = "us-east-2"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"s3-compatible-providers",children:"S3-compatible Providers"}),"\n",(0,r.jsx)(n.p,{children:"For non-AWS object stores (e.g., Cloudflare R2, MinIO, DigitalOcean Spaces, Oracle Cloud), you must explicitly provide\nthe endpoint and credentials."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hocon",children:'object-store {\n  s3 {\n    # The full URL to your provider\'s API\n    endpoint-url = "https://<account-id>.r2.cloudflarestorage.com"\n\n    # Static credentials\n    access-key = "your-access-key"\n    secret-key = "your-secret-key"\n\n    # Some providers require a specific region (often \'auto\' or \'us-east-1\')\n    region = "auto"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"filesystem",children:"Filesystem"}),"\n",(0,r.jsx)(n.p,{children:"Konifer can store files to a specified filesystem location. This filesystem path must be configured and has no default property."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hocon",children:'object-store {\n  filesystem {\n    mount-path = "/path/to/filesystem/mount"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"mount-path"})," must exist and must be the path referencing the mounted Docker volume. For example, given this Docker volume mount:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name Konifer \\\n  -p 8080:8080 \\\n  -v /path/to/your/konifer.conf:/konifer.conf \\\n  -v /object-store:/mnt/nas1/assets\n  your-registry/Konifer:latest\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"mount-path"})," should be ",(0,r.jsx)(n.code,{children:"/object-store"})," and not ",(0,r.jsx)(n.code,{children:"/mnt/nas1/assets"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"buckets-and-keys",children:"Buckets and Keys"}),"\n",(0,r.jsxs)(n.p,{children:["When using the Filesystem implementation, the ",(0,r.jsx)(n.code,{children:"bucket"})," is the top-level directory. The bucket directory is created if it does not exist.\nSimilar to the S3 implementation, the ",(0,r.jsx)(n.code,{children:"key"})," represents the generated filename."]}),"\n",(0,r.jsx)(n.h3,{id:"redirection",children:"Redirection"}),"\n",(0,r.jsxs)(n.p,{children:["When using the filesystem or in-memory object store implementations, the ",(0,r.jsx)(n.code,{children:"presigned"})," strategy is not supported."]}),"\n",(0,r.jsx)(n.h2,{id:"metadata-store-postgresql",children:"Metadata Store (PostgreSQL)"}),"\n",(0,r.jsx)(n.p,{children:"Konifer uses PostgreSQL for robust transactional support and hierarchical path queries."}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u26d4 ",(0,r.jsx)(n.strong,{children:"Requirement"}),": ltree Extension The ltree extension must be enabled on your PostgreSQL database before\nKonifer starts. Run the following SQL command as a superuser:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE EXTENSION IF NOT EXISTS ltree;\n"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Define your database connection details in the postgres block of konifer.conf."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hocon",children:'postgres {\n  host = "localhost"\n  port = 5432\n  user = "username"\n  password = "password"\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);